---
title: "shrublast"
author: "Daijun"
date: "07/03/2021"
output: html_document
---
```{r}
#install the packages before run the code
library('rgdal')
library('XML')
#install.packages("dismo", repos="http://R-Forge.R-project.org")
library('dismo')
library(dplyr)
library(Rmisc)
library(grid) 
library(ggplot2)
library(tidyverse)
library(reshape)
library(data.table)
library(weights)
library(data.table)
library('rgdal')
library(raster)
library('XML')
#install.packages("dismo", repos="http://R-Forge.R-project.org")#yes
library('dismo')
par(mfrow=c(1,1))
#sp1 for example
library(scales)#for using alpha()
library(diptest)
library(Rmisc)
library(weights)
library(raster)
```


#1.1 last data
```{r}
mean.fill<-read.table("/Users/daijunliu/Dropbox/1 EXPERIMENTAL WORK/PAPER/7 shrubland/data/mean.diver.filled.15.07.22.txt",header=TRUE,sep="\t", dec=".",fileEncoding="latin1",stringsAsFactors = T)

```
#1.2 make fig1a
```{r}
# warm site
names(mean.fill)
warm_site<-mean.fill %>%  drop_na(W_mean,LAT,LON) %>% dplyr::select(LAT,LON)%>%distinct(LAT,LON)%>%add_column(Treat="W")
# dry site
dry_site<-mean.fill %>%  drop_na(D_mean,LAT,LON) %>% dplyr::select(LAT,LON)%>%
  distinct(LAT,LON)%>%add_column(Treat="D")
#wet site
wet_site<-mean.fill %>%  drop_na(I_mean,LAT,LON) %>% dplyr::select(LAT,LON)%>%
  distinct(LAT,LON)%>%add_column(Treat="I")
#n SITE
n_site<-mean.fill %>%  drop_na(N_mean,LAT,LON) %>% dplyr::select(LAT,LON)%>%
  distinct(LAT,LON)%>%add_column(Treat="N")
# warm and n add
wn_site<-mean.fill %>%  drop_na(WN_mean,LAT,LON) %>% dplyr::select(LAT,LON)%>%
  distinct(LAT,LON)%>%add_column(Treat="WN")
# warm and water add
in_site<-mean.fill %>%  drop_na(IN_mean,LAT,LON) %>% dplyr::select(LAT,LON)%>%
  distinct(LAT,LON)%>%add_column(Treat="IN")
#add together
site_all<-Reduce(function(x,y) {merge(x,y,all=T)}, 
               list(dry_site,wet_site,warm_site,n_site,
                    wn_site,in_site))
dplyr::count(site_all,Treat)
site_all1<-site_all%>%subset(select=c(LON,LAT))%>%distinct()
```

```{r}

site_all2<-site_all
world_map <- map_data("world")
W <- ggplot() + coord_fixed() +
  xlab("x") + ylab("y")

#Add map to base plot
base_world_messy <- W + geom_polygon(data=world_map, 
                    aes(x=long, y=lat, group=group), 
                    colour="antiquewhite3", fill="antiquewhite3")
base_world_messy
site_all2$Treat<-as.factor(site_all2$Treat)
levels(site_all2$Treat)
site_all2$Treat<-factor(site_all2$Treat,c('W','I',"N",'D',"WN","IN"))
site_all2$Treat<-as.factor(site_all2$Treat)
plyr::count(site_all2$Treat)
check<-site_all2%>%subset(select=c(LAT,LON))%>%distinct()
```
```{r fig.height=2,fig.width=4}
map <- 
  base_world_messy+ 
  geom_point( data=site_all2,aes(x=LON, y=LAT,color = Treat, shape=Treat),
              size=2.5,stroke=0.4)+
  scale_shape_manual(values=c(1,2,0,6,4,3),
                     label=c('W (n=33)','P (n=21)',"N (n=27)",
                             'D (n=23)',"WN (n=5)","PN (n=4)"))+
  #scale_size_manual(values=c(3,4,3,4,5,100))+
  scale_color_manual(values=c("red3", 'blue',"magenta",
                              "peru","blue","blue"),
                     label=c('W (n=33)','P (n=21)',"N (n=27)",
                             'D (n=23)',"WN (n=5)","PN (n=4)"))+
  scale_x_continuous(name = "Longitude°",limits=c(-180,180),
                          breaks=seq(-180,180,90)) +
  annotate("text", x = -180, y = 90, label = "(a)",size=6)+
  scale_y_continuous(name="Latitude°",
                     limits=c(-90,90),breaks=seq(-90,90,45))+
  theme_bw()+
  guides(color=guide_legend(override.aes = list(size=1)))+
  theme(plot.background=element_blank(),
        axis.ticks.length=unit(0.08,"inch"),
        panel.spacing.x=unit(1, 'lines'),
        plot.title=element_text(lineheight=2,hjust=0.5),
        panel.background=element_blank(),
        panel.grid.minor=element_blank(),
        panel.grid.major=element_line(colour = "gainsboro"),
        panel.border=element_rect(fill=NULL,colour='black',
                                  linetype=1,size=1),
        # axis.line=element_line(colour='black',linetype=1),
        axis.ticks=element_line(colour='black',linetype=1),
        axis.title.y = element_text(colour='black',size=12,vjust=1),
        axis.text.y  = element_text(colour='black',vjust=0.5, size=10),
        axis.title.x = element_text(colour='black',size=12,vjust=0.2),
        axis.text.x  = element_text(colour='black',angle=0, 
                                    vjust=0.2, size=10),
        legend.position = 'right',
        legend.title=element_blank(),
        legend.text = element_text(colour="black", size = 12),
        legend.background = element_blank(),
        strip.text =  element_text(colour='black',size=25,vjust=1),
        plot.margin = unit(c(0,0,0,0),'cm'))
map
```

#1.2.1 shrub map

```{r}
#input the map fo shrubland distribution
s = raster(".../CLC2015_shrublands_Perc_1km.tif",agrument=T)
#plot(s,legend=T)

s.df<-as.data.frame(s,xy=T)
s.df<-s.df[-which(s.df$CLC2015_shrublands_Perc_1km==0),]
names(s.df)[1:3]<-c('lon','lat','per')
#write.table(s.df,file = '/Users/daijunliu/Dropbox/1 EXPERIMENTAL WORK/PAPER/7 shrubland/data/analysis/s_dataframe.csv',row.names = F,sep = ';')
library(ggplot2)
bg<-ggplot()+
  geom_tile(data=na.omit(s.df),aes(x=lon,y=lat,fill=per))+
  scale_fill_gradient2(low='white',mid='khaki',high='darkgreen')


map2 <- 
  bg+ 
  geom_point( data=site_all2,aes(x=LON, y=LAT,color = Treat, shape=Treat),
              size=2.5,stroke=0.4)+
  scale_shape_manual(values=c(1,2,0,6,4,3),
                     label=c('W (n=33)','P (n=21)',"N (n=27)",
                             'D (n=23)',"WN (n=5)","PN (n=4)"))+
  #scale_size_manual(values=c(3,4,3,4,5,100))+
  scale_color_manual(values=c("red3", 'blue',"magenta",
                              "peru","blue","blue"),
                     label=c('W (n=33)','P (n=21)',"N (n=27)",
                             'D (n=23)',"WN (n=5)","PN (n=4)"))+
  scale_x_continuous(name = "Longitude°",limits=c(-180,180),
                          breaks=seq(-180,180,60)) +
  #annotate("text", x = -180, y = 90, label = "(a)",size=6)+
  scale_y_continuous(name="Latitude°",
                     limits=c(-60,90),breaks=seq(-60,90,30))+
  theme_bw()+
  guides(color=guide_legend(override.aes = list(size=3)))+
  theme(plot.background=element_blank(),
        axis.ticks.length=unit(.2, "cm"),
        panel.spacing.x=unit(2, 'lines'),
        plot.title=element_text(lineheight=2,hjust=0.5),
        panel.background=element_blank(),
        panel.grid.minor=element_blank(),
        panel.grid.major=element_line(colour = "gainsboro"),
        panel.border=element_rect(fill=NULL,colour='black',
                                  linetype=1,size=1),
        # axis.line=element_line(colour='black',linetype=1),
        axis.ticks=element_line(colour='black',linetype=1),
        axis.title.y = element_text(colour='black',size=12,vjust=1),
        axis.text.y  = element_text(colour='black',vjust=0.5, size=10),
        axis.title.x = element_text(colour='black',size=12,vjust=0.2),
        axis.text.x  = element_text(colour='black',angle=0, 
                                    vjust=0.2, size=10),
        legend.position = 'right',
        legend.title=element_blank(),
        legend.text = element_text(colour="black", size = 10),
        legend.background = element_blank(),
        strip.text =  element_text(colour='black',size=25,vjust=1),
        plot.margin = unit(c(0,0,0.5,0),'cm'))

ggsave(map2,filename = '.../fig1a.tiff',width = 9,height =3.5,compression="lzw",dpi=200)
```
#1.3 senitivity
##1.3.1 mean treatment
```{r fig.height=5,fig.width=9}
names(mean.fill)
#calculate the mean for each variable from c to other treatments
#1 warming whole year
all.w<-
  mean.fill%>%
  subset(select=c(1,2,4,10,31))%>%drop_na()%>%
  mutate(sen=100*(W_mean-C_mean)/C_mean/AT_net)%>%add_column(Treat="W")
#2 warming for growing season
all.wgs<-
  mean.fill%>%
  subset(select=c(1,2,4,10,32))%>%drop_na()%>%
  mutate(sen=100*(W_mean-C_mean)/C_mean/GST_net)%>%add_column(Treat="W")
#3 for drought
all.d<-  mean.fill%>%
  subset(select=c(1,2,4,7,33))%>%drop_na()%>%
  mutate(sen=-100*100*(D_mean-C_mean)/C_mean/D_net)%>%add_column(Treat="D")
#4 for I
names(mean.fill)
all.i<-
  mean.fill%>%
  subset(select=c(1,2,4,13,34))%>%drop_na()%>%
  mutate(sen=100*100*(I_mean-C_mean)/C_mean/I_net)%>%add_column(Treat="P")
#5 for N
all.n<-
  mean.fill%>%
  subset(select=c(1,2,4,16,35))%>%drop_na()%>%
  mutate(sen=100*(N_mean-C_mean)/C_mean/N_net)%>%add_column(Treat="N")
#6for WN
all.wn<-
  mean.fill%>%
  subset(select=c(1,2,4,22,37))%>%drop_na()%>%
  mutate(sen=100*(WN_mean-C_mean)/C_mean/WN_net)%>%add_column(Treat="WN")
#7for IN
all.in<-
  mean.fill%>%
  subset(select=c(1,2,4,19,39))%>%drop_na()%>%
  mutate(sen=100*100*(IN_mean-C_mean)/C_mean/IN_net)%>%add_column(Treat="IN")
#add them together
names(all.w);names(all.wgs);
ALL_sen<-rbind(all.w[,c(1,2,6,7)],all.wgs[,c(1,2,6,7)],all.d[,c(1,2,6,7)],
               all.i[,c(1,2,6,7)],all.n[,c(1,2,6,7)],all.wn[,c(1,2,6,7)],
               all.in[,c(1,2,6,7)])
ALL_sen_mean<-
  ALL_sen%>%
  summarySE(measurevar = 'sen',groupvars = c('metric','Treat'),na.rm = T)%>%
  droplevels()
levels(ALL_sen_mean$metric)
ALL_sen_mean$metric<-
  factor(ALL_sen_mean$metric,c('Ratio_S','AGB_S','H','SP','DEN','COV',
                    'ANPP','AGB'))
ALL_sen_mean$Treat<-
  factor(ALL_sen_mean$Treat,c('W','P','N','D','IN','WN'))

```

##1.3.2 add weight and significance test
```{r}
names(ALL_sen)
names(mean.fill)
#for the term
site<-mean.fill%>%subset(select=c(1,27,26))%>% distinct()
site$term<-as.factor(site$term)
levels(site$term)
levels(site$term)[1:3]<-c("1","2","2")
site$term<-as.numeric(site$term)
#for the stable
site$stable<-as.factor(site$stable)
levels(site$stable)

#combine
all.av.re<-merge(ALL_sen,site,all.x=T)
all.av.re$Treat<-as.factor(all.av.re$Treat)
mean.sig<-
  ldply(levels(all.av.re$metric),function(i){
    ldply(levels(all.av.re$Treat),function(j){
      #i=levels(all.av.re$metric)[1]
    data2<-all.av.re[all.av.re$metric==i,]
      #j=levels(all.av.re$Treat)[1]
    data3<-data2[data2$Treat==j,]  
     p.value<-wtd.t.test(data3[,3],
                  weight = data3$term)$coefficients['p.value']
     means<-wtd.t.test(data3[,3],
                  weight = data3$term)$additional['Mean']
     SE<- wtd.t.test(data3[,3],
                  weight = data3$term)$additional['Std. Err']
    resul<-
      data.frame(metric=i,Treat=j,p.value=p.value,means=means,SE=SE,
                 row.names = NULL)
    })
  })

```
##1.3.4 fig1b
```{r}
ALL_sen_site<-  ALL_sen_mean%>%subset(Treat=='W'|Treat=='P'|Treat=='N'|Treat=='D')%>%
  subset(select=c(metric,Treat,n))

all.site_by_metric<-
  droplevels(ALL_sen_site[order(ALL_sen_site$Treat),])
all.site_by_metric$label_posi<-
  # W_s       I_ats       Ns         Ds
  c(rep(50,8),rep(160,8),rep(16,8),rep(32,7))
mean.sig$metric<-
  factor(mean.sig$metric,c('Ratio_S','AGB_S','H','SP','DEN','COV',
                    'ANPP','AGB'))

 fig.1b<-
  mean.sig%>%subset(Treat=='W'|Treat=='P'|Treat=='N'|Treat=='D')%>%
  mutate(Treat=factor(Treat,c('W','P','N','D')))%>%
  ggplot(aes(x=means,y=metric,color=Treat))+
  facet_grid(.~Treat,scales = 'free_x',switch = 'x')+
  geom_vline(aes(xintercept=0),linetype=2,color='grey')+
  geom_errorbarh(aes(xmin=means-SE,xmax=means+SE),na.rm = T,height=0.35)+
  geom_point(na.rm = T,size=3.0,shape=21,fill='white',stroke=0.6)+
  geom_text(data=all.site_by_metric,
        aes(x=label_posi,y=metric,label=n,
        color=Treat,group=Treat),size=2.5)+
  scale_colour_manual(values=c('red','blue','magenta2','orange'))+
  theme_bw()+
  theme(axis.title=element_blank(),
      axis.text = element_text(color='black'),
      axis.ticks.length=unit(.2, "cm"),
      strip.placement = 'outside',
      strip.background = element_blank(),
      panel.border = element_rect(color='black',fill = NA),
      strip.text = element_text(color = 'black'),
      legend.position = 'none')
 
fig.1b
ggsave(fig.1b,filename = '.../fig.1bnew.tiff',width = 9,height =3.2,compression="lzw",dpi=200) 
```

##1.3.5 Fig S1
```{r}
ALL_sen_site<-  ALL_sen_mean%>%subset(Treat=='WN'|Treat=='IN')%>%
  subset(select=c(metric,Treat,n))

all.site_by_metric<-
  droplevels(ALL_sen_site[order(ALL_sen_site$Treat),])
  all.site_by_metric$label_posi<-
  # W_s       I_ats
  c(rep(70,6),rep(10,8))
  
fig.s1<-
  ALL_sen_mean%>%subset(Treat=='WN'|Treat=='IN')%>%
  mutate(Treat=factor(Treat,c('WN','IN')))%>%
  ggplot(aes(x=sen,y=metric,color=Treat))+
  facet_grid(.~Treat,scales = 'free_x',switch = 'x')+
  geom_vline(aes(xintercept=0),linetype=2,color='grey')+
  geom_errorbarh(aes(xmin=sen-se,xmax=sen+se),
                 na.rm = T,height=0.2)+
  geom_point(na.rm = T,size=2,shape=21,fill='white')+
  geom_text(data=all.site_by_metric,
            aes(x=label_posi,y=metric,label=n,
                color=Treat,group=Treat),
           size=2.5)+
  scale_colour_manual(values=c('black','black'))+
  theme_bw()+
  theme(axis.title=element_blank(),
      axis.text = element_text(color='black'),
      axis.ticks = element_line(color='black'),
      strip.placement = 'outside',
      strip.background = element_blank(),
      panel.border = element_rect(color='black',fill = NA),
      strip.text = element_text(color = 'black'),
      legend.position = 'none')
fig.s1
ggsave(fig.s1,filename = '.../fig1s.tiff',width = 9,height =3.5,compression="lzw",dpi=200) 
  
```

#1.4 temporal/spatial
##1.4.1 temp
```{r}
names(ALL_sen);names(site)
#combine
all.av.re<-merge(ALL_sen,site,all.x=T)
all.av.re$Treat<-as.factor(all.av.re$Treat)
all.av.re$term<-as.factor(all.av.re$term)
all.av.re$metric<-as.factor(all.av.re$metric)
library(agricolae)

#to compare whether there are different for term, only two variables
p.check.tem<-
  ldply(levels(all.av.re$metric),function(m){
  #m=levels(all.av.re$metric)[1]
  df1<-all.av.re%>%subset(metric==m)

  resu1<-ldply(levels(df1$Treat)[1:6],function(n){
    #n=levels(df1$Treat)[4]
    #print(n)
    df2<-df1%>%subset(Treat==n)%>%droplevels()   
    if(length(levels(df2$term))>1){
      attach(df2,warn.conflicts = F)
      model<-aov(sen~term,data = df2)
      allp<-summary(model)
      allp<-allp[[1]][["Pr(>F)"]][[1]]
      resu<-data.frame(Treat=n,metric=m,pvalue=allp)
      return(resu)
    }
    })
  return(resu1)
})

#to check the difference between short-term and long-term
```

##1.4.2 stable
```{r}
#combine term and disturbance
names(all.av.re)
all.av.re.la<-all.av.re%>%mutate(stable=as.factor(as.character(stable)))

#test the disturbance on the sig
p.check.stable<-
  ldply(levels(all.av.re.la$metric),function(m){
  #m=levels(all.av.re$metric)[1]
  df1<-all.av.re.la%>%subset(metric==m)

  resu1<-ldply(levels(df1$Treat)[1:6],function(n){
    #n=levels(df1$Treat)[4]
    #print(n)
    df2<-df1%>%subset(Treat==n)%>%droplevels()   
    if(length(levels(df2$stable))>1){
      attach(df2,warn.conflicts = F)
      model<-aov(sen~stable,data = df2)
      allp<-summary(model)
      allp<-allp[[1]][["Pr(>F)"]][[1]]
      resu<-data.frame(Treat=n,metric=m,pvalue=allp)
      return(resu)
    }
    })
  return(resu1)
})
#to check the significance between disturbed and stable ones
```
##1.4.3 get the plots (Fig2)
```{r}
names(all.av.re.la)
yy<-all.av.re.la%>%
  filter(metric=="AGB"|metric=="COV"|metric=="DEN"|metric=="SP"|
         metric=="H")%>%
  subset(Treat=="W"|Treat=="P"|Treat=="N"|Treat=="D")%>%
  droplevels()%>%
  mutate(Treat=factor(Treat,c('W','P','N','D')))%>%
  mutate(metric=factor(metric,c('H','SP',"DEN",'COV','AGB')))%>%
  mutate(term=factor(term,c('2','1')))%>%
  summarySE(measurevar = 'sen',groupvars = c('metric','Treat',"term"),na.rm = T)
#PLOT
plota<-  
  yy%>%filter(metric!="H"|Treat!="P")%>%
ggplot(aes(x=sen,y=metric,color=Treat,group=term))+
  facet_grid(.~Treat,scales = 'free_x',switch = 'x')+
  geom_vline(aes(xintercept=0),linetype=2,color='grey')+
  geom_errorbarh(aes(xmin=sen-se,xmax=sen+se),na.rm = T,height=0.35
                 ,position=position_dodge(0.5))+
  geom_point(aes(size=term),na.rm = T,fill='white',shape=21,
             position=position_dodge(0.5))+
  scale_size_manual(values = c(3,2.2))+
  scale_colour_manual(values=c('red','blue','magenta2','orange'))+
  theme_bw()+
  theme(axis.title=element_blank(),
        axis.ticks.length=unit(.2, "cm"),
          panel.spacing.x=unit(1.0, 'lines'),
      axis.text = element_text(color='black'),
      axis.ticks = element_line(color='black'),
      strip.placement = 'outside',
      strip.background = element_blank(),
      panel.border = element_rect(color='black',fill = NA),
      strip.text = element_text(color = 'black'),
      legend.position = 'none')
plota
```

```{r fig.width=6,fig.height=1.8}
plota 
 #sig P AGB***;  N H*  
#ggsave(plota,filename = '/Users/daijunliu/Downloads/fig2a.tiff',width = 9.5,height =3,compression="lzw",dpi=200)
```


```{r}
#2) stable or not
names(all.av.re.la)
yy2<-all.av.re.la%>%
  filter(metric=="AGB"|metric=="COV"|metric=="DEN"|metric=="SP"|
         metric=="H")%>%
  subset(Treat=="W"|Treat=="P"|Treat=="N"|Treat=="D")%>%
  droplevels()%>%
  mutate(Treat=factor(Treat,c('W','P','N','D')))%>%
  mutate(metric=factor(metric,c('H','SP',"DEN",'COV','AGB')))%>%
  mutate(stable=factor(stable,c('2','1')))%>%
  summarySE(measurevar = 'sen',groupvars = c('metric','Treat',"stable"),na.rm = T)

#PLOT
plotb<-  
  yy2%>%filter(metric!="AGB"|Treat!="P")%>%filter(metric!="DEN"|Treat!="P")%>%
      filter(metric!="SP"|Treat!="P")%>%filter(metric!="AGB"|Treat!="N")%>%  
ggplot(aes(x=sen,y=metric,color=Treat,group=stable))+
  facet_grid(.~Treat,scales = 'free_x',switch = 'x')+
  geom_vline(aes(xintercept=0),linetype=2,color='grey')+
  geom_errorbarh(aes(xmin=sen-se,xmax=sen+se),na.rm = T,height=0.4
                 ,position=position_dodge(0.6))+
  geom_point(aes(shape=stable),na.rm = T,fill='white',size=3,
             position=position_dodge(0.6))+
  scale_shape_manual(values=c(24, 21))+
  scale_colour_manual(values=c('red','blue','magenta2','orange'))+
  theme_bw()+
  theme(axis.title=element_blank(),
        axis.ticks.length=unit(.2, "cm"),
        panel.spacing.x=unit(1.0, 'lines'),
      axis.text = element_text(color='black'),
      axis.ticks = element_line(color='black'),
      strip.placement = 'outside',
      strip.background = element_blank(),
      panel.border = element_rect(color='black',fill = NA),
      strip.text = element_text(color = 'black'),
      legend.position = 'none')
```


```{r fig.width=6,fig.height=1.8}
plotb 
 #sig D den***, P sp*, N H*  
#ggsave(plotb,filename = '/Users/daijunliu/Downloads/fig2b.tiff',width = 9.5,height =3,compression="lzw",dpi=200)  
```

#1.5 find climate driver
```{r}
#import the file with climate data and then test the relationships between sensitivity and climate mediators.
test<-read.table(".../sen.climate.csv",header=TRUE,sep=";",dec=".",fileEncoding="latin1",stringsAsFactors = T)
```

#1.5.1 Warming
##AGB
```{r}
#1) warming
names(sen.climate)
study.site.last<-sen.climate%>%filter(metric=="AGB")%>%filter(Treat=="W")%>%
       distinct()
#2)test sig correlation LME
library(afex)#to show the p sen

lm.MAT<-lmer(sen~ MAT+(1|code),data=study.site.last)
lm.AI<-lmer(sen~ AI+(1|code),data=study.site.last)
lm.MAP<-lmer(sen~ MAP+(1|code),data=study.site.last)
lm.pre_S<-lmer(sen~ pre_S+(1|code),data=study.site.last)
lm.meanT_Q<-lmer(sen~ meanT_Q+(1|code),data=study.site.last)
lm.Pdry_Q<-lmer(sen~ Pdry_Q+(1|code),data=study.site.last)
lm.maxT_m<-lmer(sen~ maxT_m+(1|code),data=study.site.last)
lm.sm_10cm<-lmer(sen~ mean_10cm.sm+(1|code),data=study.site.last)
lm.sm_40cm<-lmer(sen~ mean_40cm.sm+(1|code),data=study.site.last)
lm.sm_1m<-lmer(sen~ mean_1m.sm+(1|code),data=study.site.last)
AIC(lm.MAT);AIC(lm.AI);AIC(lm.MAP);AIC(lm.pre_S);AIC(lm.meanT_Q);AIC(lm.Pdry_Q);AIC(lm.maxT_m);AIC(lm.sm_10cm);AIC(lm.sm_40cm);AIC(lm.sm_1m)

AIC(lm.MAT);AIC(lm.maxT_m);AIC(lm.MAP);AIC(lm.AI);AIC(lm.sm_10cm);AIC(lm.sm_40cm)
summary(lm.AI)

```

```{r}
#3)figure
figw_agb<-ggplot(study.site.last, aes(AI,sen))+
  
  geom_point(shape=21,color="red",aes(size=factor(term)),stroke=0.8)+
  
  #geom_smooth(method = "lm",formula=y~log(x),se=T,fill="indianred1",color='red',size=1.2)+
  #labs(title = "Warming")+
  #annotate("text", x = 0.05, y = 150, label = "a",size=6)+
  #annotate("text", x = 20, y = -30, label = "R2=0.15, p = 0.02",size=4)+
  scale_x_continuous(name = "Aridity index",limits=c(0,3.3),breaks=seq(0,3,1)) +
  scale_y_continuous(name="AGB",limits=c(-60,140),
                     breaks=seq(-60,120,60))+
  geom_hline(yintercept=0, linetype="dashed", color = "black",size=1.0)+
  theme_bw()+
  theme(plot.background=element_blank(),
        panel.spacing.x=unit(2, 'lines'),
        axis.ticks.length=unit(.2, "cm"),
        plot.title=element_text(lineheight=2,hjust=0.5),
        panel.background=element_blank(),
        #panel.grid.minor=element_blank(),
        #panel.grid.major=element_blank(),
        panel.border=element_rect(fill=NULL,colour='black',linetype=1,size=1),
        # axis.line=element_line(colour='black',linetype=1),
        axis.ticks=element_line(colour='black',linetype=1),
        axis.title.y = element_blank(),
        axis.text.y  = element_text(colour='black',vjust=0.5, size=10),
        axis.title.x = element_text(colour='black',size=12,vjust=0.2),
        axis.text.x  = element_text(colour='black',angle=0, vjust=0.2, size=10),
        legend.position = 'none',
        strip.background = element_blank(),
        strip.text =  element_text(colour='black',size=25,vjust=1),
        plot.margin = unit(c(0.2,0.2,0.2,0.2),'cm'))
figw_agb
```

##COV
```{r}
#1) warming
names(sen.climate)
study.site.last<-sen.climate%>%filter(metric=="COV")%>%filter(Treat=="W")%>%
       distinct()
#2)test sig correlation LME
library(afex)#to show the p sen
lm.MAT<-lmer(sen~ MAT+(1|code),data=study.site.last)
lm.AI<-lmer(sen~ AI+(1|code),data=study.site.last)
lm.MAP<-lmer(sen~ MAP+(1|code),data=study.site.last)
lm.pre_S<-lmer(sen~ pre_S+(1|code),data=study.site.last)
lm.meanT_Q<-lmer(sen~ meanT_Q+(1|code),data=study.site.last)
lm.Pdry_Q<-lmer(sen~ Pdry_Q+(1|code),data=study.site.last)
lm.maxT_m<-lmer(sen~ maxT_m+(1|code),data=study.site.last)
lm.sm_10cm<-lmer(sen~ mean_10cm.sm+(1|code),data=study.site.last)
lm.sm_40cm<-lmer(sen~ mean_40cm.sm+(1|code),data=study.site.last)
lm.sm_1m<-lmer(sen~ mean_1m.sm+(1|code),data=study.site.last)
AIC(lm.MAT);AIC(lm.AI);AIC(lm.MAP);AIC(lm.pre_S);AIC(lm.meanT_Q);AIC(lm.Pdry_Q);AIC(lm.maxT_m);AIC(lm.sm_10cm);AIC(lm.sm_40cm);AIC(lm.sm_1m)

AIC(lm.MAT);AIC(lm.maxT_m);AIC(lm.MAP);AIC(lm.AI);AIC(lm.sm_10cm);AIC(lm.sm_40cm)

summary(lm.AI)
lm.AI.log<-lmer(sen~ log(AI)+(1|code),data=study.site.last)
AIC(lm.AI.log)
summary(lm.AI.log)

```

```{r}
#3)figure
figw_cov<-ggplot(study.site.last, aes(AI,sen))+
  
  geom_point(shape=21,color="red",aes(size=factor(term)),stroke=0.8)+
  
  geom_smooth(method = "lm",formula=y~log(x),se=T,fill="indianred1",color='red',size=1.2)+
  #labs(title = "Warming")+
  #annotate("text", x = 0.05, y = 150, label = "a",size=6)+
  #annotate("text", x = 20, y = -30, label = "R2=0.15, p = 0.02",size=4)+
  scale_x_continuous(name = "Aridity index",limits=c(0,2.5),breaks=seq(0,2.5,0.6)) +
  scale_y_continuous(name="COV",limits=c(-80,40),
                     breaks=seq(-80,40,40))+
  geom_hline(yintercept=0, linetype="dashed", color = "black",size=1.0)+
  theme_bw()+
  theme(plot.background=element_blank(),
        panel.spacing.x=unit(2, 'lines'),
        axis.ticks.length=unit(.2, "cm"),
        plot.title=element_text(lineheight=2,hjust=0.5),
        panel.background=element_blank(),
        #panel.grid.minor=element_blank(),
        #panel.grid.major=element_blank(),
        panel.border=element_rect(fill=NULL,colour='black',linetype=1,size=1),
        # axis.line=element_line(colour='black',linetype=1),
        axis.ticks=element_line(colour='black',linetype=1),
        axis.title.y = element_blank(),
        axis.text.y  = element_text(colour='black',vjust=0.5, size=10),
        axis.title.x = element_text(colour='black',size=12,vjust=0.2),
        axis.text.x  = element_text(colour='black',angle=0, vjust=0.2, size=10),
        legend.position = 'none',
        strip.background = element_blank(),
        strip.text =  element_text(colour='black',size=25,vjust=1),
        plot.margin = unit(c(0.2,0.2,0.2,0.2),'cm'))
figw_cov
```
##DEN
```{r}
#1) warming
names(sen.climate)
study.site.last<-sen.climate%>%filter(metric=="DEN")%>%filter(Treat=="W")%>%
       distinct()
#2)test sig correlation LME
library(afex)#to show the p sen
lm.MAT<-lmer(sen~ MAT+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.AI<-lmer(sen~ AI+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.MAP<-lmer(sen~ MAP+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.pre_S<-lmer(sen~ pre_S+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.meanT_Q<-lmer(sen~ meanT_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.Pdry_Q<-lmer(sen~ Pdry_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.maxT_m<-lmer(sen~ maxT_m+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_10cm<-lmer(sen~ mean_10cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_40cm<-lmer(sen~ mean_40cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_1m<-lmer(sen~ mean_1m.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
AIC(lm.MAT);AIC(lm.AI);AIC(lm.MAP);AIC(lm.pre_S);AIC(lm.meanT_Q);AIC(lm.Pdry_Q);AIC(lm.maxT_m);AIC(lm.sm_10cm);AIC(lm.sm_40cm);AIC(lm.sm_1m)

AIC(lm.MAT);AIC(lm.maxT_m);AIC(lm.MAP);AIC(lm.AI);AIC(lm.sm_10cm);AIC(lm.sm_40cm)


summary(lm.maxT_m)

lm.maxT_m.log<-lmer(sen~ log(maxT_m)+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
summary(lm.maxT_m.log)

```

```{r}
#3)figure
figw_den<-ggplot(study.site.last, aes(maxT_m,sen))+
  
  geom_point(shape=21,color="red",aes(size=factor(term)),stroke=0.8)+
  geom_smooth(method = "lm",formula=y~log(x),se=T,fill="indianred1",color='red',size=1.2)+
  #labs(title = "Warming")+
  #annotate("text", x = 0.05, y = 150, label = "a",size=6)+
  #annotate("text", x = 20, y = -30, label = "R2=0.15, p = 0.02",size=4)+
  scale_x_continuous(name = "Max T of warmest month (°C)",limits=c(11,17),breaks=seq(11,17,2)) +
  scale_y_continuous(name="DEN",limits=c(-12,22),
                     breaks=seq(-10,20,10))+
  geom_hline(yintercept=0, linetype="dashed", color = "black",size=1.0)+
  theme_bw()+
  theme(plot.background=element_blank(),
        panel.spacing.x=unit(2, 'lines'),
        axis.ticks.length=unit(.2, "cm"),
        plot.title=element_text(lineheight=2,hjust=0.5),
        panel.background=element_blank(),
        #panel.grid.minor=element_blank(),
        #panel.grid.major=element_blank(),
        panel.border=element_rect(fill=NULL,colour='black',linetype=1,size=1),
        # axis.line=element_line(colour='black',linetype=1),
        axis.ticks=element_line(colour='black',linetype=1),
        axis.title.y = element_blank(),
        axis.text.y  = element_text(colour='black',vjust=0.5, size=10),
        axis.title.x = element_text(colour='black',size=12,vjust=0.2),
        axis.text.x  = element_text(colour='black',angle=0, vjust=0.2, size=10),
        legend.position = 'none',
        strip.background = element_blank(),
        strip.text =  element_text(colour='black',size=25,vjust=1),
        plot.margin = unit(c(0.2,0.2,0.2,0.2),'cm'))
figw_den
```
##SP
```{r}
#1) warming
names(sen.climate)
study.site.last<-sen.climate%>%filter(metric=="SP")%>%filter(Treat=="W")%>%
       distinct()
#2)test sig correlation LME
library(afex)#to show the p sen
lm.MAT<-lmer(sen~ MAT+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.AI<-lmer(sen~ AI+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.MAP<-lmer(sen~ MAP+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.pre_S<-lmer(sen~ pre_S+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.meanT_Q<-lmer(sen~ meanT_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.Pdry_Q<-lmer(sen~ Pdry_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.maxT_m<-lmer(sen~ maxT_m+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_10cm<-lmer(sen~ mean_10cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_40cm<-lmer(sen~ mean_40cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_1m<-lmer(sen~ mean_1m.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
AIC(lm.MAT);AIC(lm.AI);AIC(lm.MAP);AIC(lm.pre_S);AIC(lm.meanT_Q);AIC(lm.Pdry_Q);AIC(lm.maxT_m);AIC(lm.sm_10cm);AIC(lm.sm_40cm);AIC(lm.sm_1m)

AIC(lm.MAT);AIC(lm.maxT_m);AIC(lm.MAP);AIC(lm.AI);AIC(lm.sm_10cm);AIC(lm.sm_40cm)


summary(lm.AI)

```

```{r}
#3)figure
figw_sp<-ggplot(study.site.last, aes(AI,sen))+
  
  geom_point(shape=21,color="red",aes(size=factor(term)),stroke=0.8)+
  
  #geom_smooth(method = "lm",formula=y~log(x),se=T,fill="indianred1",color='red',size=1.2)+
  #labs(title = "Warming")+
  #annotate("text", x = 0.05, y = 150, label = "a",size=6)+
  #annotate("text", x = 20, y = -30, label = "R2=0.15, p = 0.02",size=4)+
  scale_x_continuous(name = "Aridity index",limits=c(0,3),breaks=seq(0,3,1)) +
  scale_y_continuous(name="SP",limits=c(-90,40),
                     breaks=seq(-90,30,30))+
  geom_hline(yintercept=0, linetype="dashed", color = "black",size=1.0)+
  theme_bw()+
  theme(plot.background=element_blank(),
        panel.spacing.x=unit(2, 'lines'),
        axis.ticks.length=unit(.2, "cm"),
        plot.title=element_text(lineheight=2,hjust=0.5),
        panel.background=element_blank(),
        #panel.grid.minor=element_blank(),
        #panel.grid.major=element_blank(),
        panel.border=element_rect(fill=NULL,colour='black',linetype=1,size=1),
        # axis.line=element_line(colour='black',linetype=1),
        axis.ticks=element_line(colour='black',linetype=1),
        axis.title.y = element_blank(),
        axis.text.y  = element_text(colour='black',vjust=0.5, size=10),
        axis.title.x = element_text(colour='black',size=12,vjust=0.2),
        axis.text.x  = element_text(colour='black',angle=0, vjust=0.2, size=10),
        legend.position = 'none',
        strip.background = element_blank(),
        strip.text =  element_text(colour='black',size=25,vjust=1),
        plot.margin = unit(c(0.2,0.2,0.2,0.2),'cm'))
figw_sp
```
##H
```{r}
#1) warming
names(sen.climate)
study.site.last<-sen.climate%>%filter(metric=="H")%>%filter(Treat=="W")%>%
       distinct()
#2)test sig correlation LME
library(afex)#to show the p sen
lm.MAT<-lmer(sen~ MAT+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.AI<-lmer(sen~ AI+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.MAP<-lmer(sen~ MAP+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.pre_S<-lmer(sen~ pre_S+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.meanT_Q<-lmer(sen~ meanT_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.Pdry_Q<-lmer(sen~ Pdry_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.maxT_m<-lmer(sen~ maxT_m+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_10cm<-lmer(sen~ mean_10cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_40cm<-lmer(sen~ mean_40cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_1m<-lmer(sen~ mean_1m.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
AIC(lm.MAT);AIC(lm.AI);AIC(lm.MAP);AIC(lm.pre_S);AIC(lm.meanT_Q);AIC(lm.Pdry_Q);AIC(lm.maxT_m);AIC(lm.sm_10cm);AIC(lm.sm_40cm);AIC(lm.sm_1m)

AIC(lm.MAT);AIC(lm.maxT_m);AIC(lm.MAP);AIC(lm.AI);AIC(lm.sm_10cm);AIC(lm.sm_40cm)


summary(lm.MAT)#

```
```{r}
#3)figure
figw_h<-ggplot(study.site.last, aes(MAT,sen))+
  
  geom_point(shape=21,color="red",aes(size=factor(term)),stroke=0.8)+
  
  geom_smooth(method = "lm",formula=y~x,se=T,fill="indianred1",color='red',size=1.2)+
  #labs(title = "Warming")+
  #annotate("text", x = 0.05, y = 150, label = "a",size=6)+
  #annotate("text", x = 20, y = -30, label = "R2=0.15, p = 0.02",size=4)+
  scale_x_continuous(name = "Mean annual temperature(°C)",limits=c(-20,25),breaks=seq(-20,20,10)) +
  scale_y_continuous(name="H",limits=c(-60,30),
                     breaks=seq(-60,30,30))+
  geom_hline(yintercept=0, linetype="dashed", color = "black",size=1.0)+
  theme_bw()+
  theme(plot.background=element_blank(),
        panel.spacing.x=unit(2, 'lines'),
        axis.ticks.length=unit(.2, "cm"),
        plot.title=element_text(lineheight=2,hjust=0.5),
        panel.background=element_blank(),
        #panel.grid.minor=element_blank(),
        #panel.grid.major=element_blank(),
        panel.border=element_rect(fill=NULL,colour='black',linetype=1,size=1),
        # axis.line=element_line(colour='black',linetype=1),
        axis.ticks=element_line(colour='black',linetype=1),
        axis.title.y = element_blank(),
        axis.text.y  = element_text(colour='black',vjust=0.5, size=10),
        axis.title.x = element_text(colour='black',size=12,vjust=0.2),
        axis.text.x  = element_text(colour='black',angle=0, vjust=0.2, size=10),
        legend.position = 'none',
        strip.background = element_blank(),
        strip.text =  element_text(colour='black',size=25,vjust=1),
        plot.margin = unit(c(0.2,0.2,0.2,0.2),'cm'))
figw_h
```
##plot
```{r fig.width=3,fig.height=9}
w<-cowplot::plot_grid(figw_agb,figw_cov,figw_den,figw_sp,figw_h,ncol=1,align = 'hv')
ggsave(w,filename = '/Users/daijunliu/Downloads/w_all.tiff',width = 3,height = 10,dpi = 200)
```


#1.5.2 increased precipitation
##AGB
```{r}
names(sen.climate)
study.site.last<-sen.climate%>%filter(metric=="AGB")%>%filter(Treat=="P")%>%
       distinct()
#2)test sig correlation LME
library(afex)#to show the p sen
lm.MAT<-lmer(sen~ MAT+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.AI<-lmer(sen~ AI+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.MAP<-lmer(sen~ MAP+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.pre_S<-lmer(sen~ pre_S+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.meanT_Q<-lmer(sen~ meanT_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.Pdry_Q<-lmer(sen~ Pdry_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.maxT_m<-lmer(sen~ maxT_m+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_10cm<-lmer(sen~ mean_10cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_40cm<-lmer(sen~ mean_40cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_1m<-lmer(sen~ mean_1m.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
AIC(lm.MAT);AIC(lm.AI);AIC(lm.MAP);AIC(lm.pre_S);AIC(lm.meanT_Q);AIC(lm.Pdry_Q);AIC(lm.maxT_m);AIC(lm.sm_10cm);AIC(lm.sm_40cm);AIC(lm.sm_1m)

AIC(lm.MAT);AIC(lm.maxT_m);AIC(lm.MAP);AIC(lm.AI);AIC(lm.sm_10cm);AIC(lm.sm_40cm)

summary(lm.AI)

lm.AI.log<-lmer(sen~ log(AI)+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
summary(lm.AI.log) 

```
```{r}
#3)figure
figp_agb<-ggplot(study.site.last, aes(AI,sen))+
  
  geom_point(shape=21,color="blue",aes(size=factor(term)),stroke=0.8)+
  
  geom_smooth(method = "lm",formula=y~log(x),se=T,
              fill="cornflowerblue",color='blue',size=1.2)+
  #labs(title = "Warming")+
  #annotate("text", x = 0.05, y = 150, label = "a",size=6)+
  #annotate("text", x = 20, y = -30, label = "R2=0.15, p = 0.02",size=4)+
  scale_x_continuous(name = "Aridity index",limits=c(0,2),breaks=seq(0,2,0.5)) +
  scale_y_continuous(name="AGB sensitivity under W",limits=c(-200,400),
                     breaks=seq(-200,400,200))+
  geom_hline(yintercept=0, linetype="dashed", color = "black",size=1.0)+
  theme_bw()+
  theme(plot.background=element_blank(),
        panel.spacing.x=unit(2, 'lines'),
        axis.ticks.length=unit(.2, "cm"),
        plot.title=element_text(lineheight=2,hjust=0.5),
        panel.background=element_blank(),
        #panel.grid.minor=element_blank(),
        #panel.grid.major=element_blank(),
        panel.border=element_rect(fill=NULL,colour='black',linetype=1,size=1),
        # axis.line=element_line(colour='black',linetype=1),
        axis.ticks=element_line(colour='black',linetype=1),
        axis.title.y = element_blank(),
        axis.text.y  = element_text(colour='black',vjust=0.5, size=10),
        axis.title.x = element_text(colour='black',size=12,vjust=0.2),
        axis.text.x  = element_text(colour='black',angle=0, vjust=0.2, size=10),
        legend.position = 'none',
        strip.background = element_blank(),
        strip.text =  element_text(colour='black',size=25,vjust=1),
        plot.margin = unit(c(0.2,0.2,0.2,0.2),'cm'))
figp_agb
```
##COV
```{r}
names(sen.climate)
study.site.last<-sen.climate%>%filter(metric=="COV")%>%filter(Treat=="P")%>%
       distinct()
#2)test sig correlation LME
library(afex)#to show the p sen
lm.MAT<-lmer(sen~ MAT+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.AI<-lmer(sen~ AI+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.MAP<-lmer(sen~ MAP+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.pre_S<-lmer(sen~ pre_S+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.meanT_Q<-lmer(sen~ meanT_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.Pdry_Q<-lmer(sen~ Pdry_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.maxT_m<-lmer(sen~ maxT_m+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_10cm<-lmer(sen~ mean_10cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_40cm<-lmer(sen~ mean_40cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_1m<-lmer(sen~ mean_1m.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
AIC(lm.MAT);AIC(lm.AI);AIC(lm.MAP);AIC(lm.pre_S);AIC(lm.meanT_Q);AIC(lm.Pdry_Q);AIC(lm.maxT_m);AIC(lm.sm_10cm);AIC(lm.sm_40cm);AIC(lm.sm_1m)

AIC(lm.MAT);AIC(lm.maxT_m);AIC(lm.MAP);AIC(lm.AI);AIC(lm.sm_10cm);AIC(lm.sm_40cm)


summary(lm.AI)


lm.AI.log<-lmer(sen~ log(AI)+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
summary(lm.AI.log) 

```
```{r}
#3)figure
figp_cov<-ggplot(study.site.last, aes(AI,sen))+
  
  geom_point(shape=21,color="blue",aes(size=factor(term)),stroke=0.8)+
  
  geom_smooth(method = "lm",formula=y~x,se=T,
              fill="cornflowerblue",color='blue',size=1.2)+
  #labs(title = "Warming")+
  #annotate("text", x = 0.05, y = 150, label = "a",size=6)+
  #annotate("text", x = 20, y = -30, label = "R2=0.15, p = 0.02",size=4)+
  scale_x_continuous(name = "Aridity index",limits=c(0,0.3),breaks=seq(0,0.3,0.1)) +
  scale_y_continuous(name="AGB sensitivity under W",limits=c(-50,100),
                     breaks=seq(-50,100,50))+
  geom_hline(yintercept=0, linetype="dashed", color = "black",size=1.0)+
  theme_bw()+
  theme(plot.background=element_blank(),
        panel.spacing.x=unit(2, 'lines'),
        axis.ticks.length=unit(.2, "cm"),
        plot.title=element_text(lineheight=2,hjust=0.5),
        panel.background=element_blank(),
        #panel.grid.minor=element_blank(),
        #panel.grid.major=element_blank(),
        panel.border=element_rect(fill=NULL,colour='black',linetype=1,size=1),
        # axis.line=element_line(colour='black',linetype=1),
        axis.ticks=element_line(colour='black',linetype=1),
        axis.title.y = element_blank(),
        axis.text.y  = element_text(colour='black',vjust=0.5, size=10),
        axis.title.x = element_text(colour='black',size=12,vjust=0.2),
        axis.text.x  = element_text(colour='black',angle=0, vjust=0.2, size=10),
        legend.position = 'none',
        strip.background = element_blank(),
        strip.text =  element_text(colour='black',size=25,vjust=1),
        plot.margin = unit(c(0.2,0.2,0.2,0.2),'cm'))
figp_cov
```

##DEN
```{r}
names(sen.climate)
study.site.last<-sen.climate%>%filter(metric=="DEN")%>%filter(Treat=="P")%>%
       distinct()
#2)test sig correlation LME
library(afex)#to show the p sen
lm.MAT<-lmer(sen~ MAT+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.AI<-lmer(sen~ AI+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.MAP<-lmer(sen~ MAP+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.pre_S<-lmer(sen~ pre_S+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.meanT_Q<-lmer(sen~ meanT_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.Pdry_Q<-lmer(sen~ Pdry_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.maxT_m<-lmer(sen~ maxT_m+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_10cm<-lmer(sen~ mean_10cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_40cm<-lmer(sen~ mean_40cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_1m<-lmer(sen~ mean_1m.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
AIC(lm.MAT);AIC(lm.AI);AIC(lm.MAP);AIC(lm.pre_S);AIC(lm.meanT_Q);AIC(lm.Pdry_Q);AIC(lm.maxT_m);AIC(lm.sm_10cm);AIC(lm.sm_40cm);AIC(lm.sm_1m)

AIC(lm.MAT);AIC(lm.maxT_m);AIC(lm.MAP);AIC(lm.AI);AIC(lm.sm_10cm);AIC(lm.sm_40cm)

summary(lm.AI)

lm.AI.log<-lmer(sen~ log(AI)+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
summary(lm.AI.log) 

```
```{r}
#3)figure
figp_den<-ggplot(study.site.last, aes(AI,sen))+
  
  geom_point(shape=21,color="blue",aes(size=factor(term)),stroke=0.8)+
  
  geom_smooth(method = "lm",formula=y~log(x),se=T,
              fill="cornflowerblue",color='blue',size=1.2)+
  #labs(title = "Warming")+
  #annotate("text", x = 0.05, y = 150, label = "a",size=6)+
  #annotate("text", x = 20, y = -30, label = "R2=0.15, p = 0.02",size=4)+
  scale_x_continuous(name = "Aridity index",limits=c(0,0.6),breaks=seq(0,0.6,0.2)) +
  scale_y_continuous(name="AGB sensitivity under W",limits=c(-120,360),
                     breaks=seq(-120,360,120))+
  geom_hline(yintercept=0, linetype="dashed", color = "black",size=1.0)+
  theme_bw()+
  theme(plot.background=element_blank(),
        panel.spacing.x=unit(2, 'lines'),
        axis.ticks.length=unit(.2, "cm"),
        plot.title=element_text(lineheight=2,hjust=0.5),
        panel.background=element_blank(),
        #panel.grid.minor=element_blank(),
        #panel.grid.major=element_blank(),
        panel.border=element_rect(fill=NULL,colour='black',linetype=1,size=1),
        # axis.line=element_line(colour='black',linetype=1),
        axis.ticks=element_line(colour='black',linetype=1),
        axis.title.y = element_blank(),
        axis.text.y  = element_text(colour='black',vjust=0.5, size=10),
        axis.title.x = element_text(colour='black',size=12,vjust=0.2),
        axis.text.x  = element_text(colour='black',angle=0, vjust=0.2, size=10),
        legend.position = 'none',
        strip.background = element_blank(),
        strip.text =  element_text(colour='black',size=25,vjust=1),
        plot.margin = unit(c(0.2,0.2,0.2,0.2),'cm'))
figp_den
```
##SP
```{r}
names(sen.climate)
study.site.last<-sen.climate%>%filter(metric=="SP")%>%filter(Treat=="P")%>%
       distinct()
#2)test sig correlation LME
library(afex)#to show the p sen
lm.MAT<-lmer(sen~ MAT+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.AI<-lmer(sen~ AI+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.MAP<-lmer(sen~ MAP+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.pre_S<-lmer(sen~ pre_S+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.meanT_Q<-lmer(sen~ meanT_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.Pdry_Q<-lmer(sen~ Pdry_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.maxT_m<-lmer(sen~ maxT_m+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_10cm<-lmer(sen~ mean_10cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_40cm<-lmer(sen~ mean_40cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_1m<-lmer(sen~ mean_1m.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
AIC(lm.MAT);AIC(lm.AI);AIC(lm.MAP);AIC(lm.pre_S);AIC(lm.meanT_Q);AIC(lm.Pdry_Q);AIC(lm.maxT_m);AIC(lm.sm_10cm);AIC(lm.sm_40cm);AIC(lm.sm_1m)

AIC(lm.MAT);AIC(lm.maxT_m);AIC(lm.MAP);AIC(lm.AI);AIC(lm.sm_10cm);AIC(lm.sm_40cm)

summary(lm.AI)

```
```{r}
#3)figure
figp_sp<-ggplot(study.site.last, aes(AI,sen))+
  
  geom_point(shape=21,color="blue",aes(size=factor(term)),stroke=0.8)+
  
  #geom_smooth(method = "lm",formula=y~log(x),se=T,
  #            fill="cornflowerblue",color='blue',size=1.2)+
  #labs(title = "Warming")+
  #annotate("text", x = 0.05, y = 150, label = "a",size=6)+
  #annotate("text", x = 20, y = -30, label = "R2=0.15, p = 0.02",size=4)+
  scale_x_continuous(name = "Aridity index",limits=c(0,2),breaks=seq(0,2,0.5)) +
  scale_y_continuous(name="SP sensitivity under W",limits=c(-40,120),
                     breaks=seq(-40,120,40))+
  geom_hline(yintercept=0, linetype="dashed", color = "black",size=1.0)+
  theme_bw()+
  theme(plot.background=element_blank(),
        panel.spacing.x=unit(2, 'lines'),
        axis.ticks.length=unit(.2, "cm"),
        plot.title=element_text(lineheight=2,hjust=0.5),
        panel.background=element_blank(),
        #panel.grid.minor=element_blank(),
        #panel.grid.major=element_blank(),
        panel.border=element_rect(fill=NULL,colour='black',linetype=1,size=1),
        # axis.line=element_line(colour='black',linetype=1),
        axis.ticks=element_line(colour='black',linetype=1),
        axis.title.y = element_blank(),
        axis.text.y  = element_text(colour='black',vjust=0.5, size=10),
        axis.title.x = element_text(colour='black',size=12,vjust=0.2),
        axis.text.x  = element_text(colour='black',angle=0, vjust=0.2, size=10),
        legend.position = 'none',
        strip.background = element_blank(),
        strip.text =  element_text(colour='black',size=25,vjust=1),
        plot.margin = unit(c(0.2,0.2,0.2,0.2),'cm'))
figp_sp
```

##H
```{r}
names(sen.climate)
study.site.last<-sen.climate%>%filter(metric=="H")%>%filter(Treat=="P")%>%
       distinct()
#2)test sig correlation LME
library(afex)#to show the p sen
lm.MAT<-lmer(sen~ MAT+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.AI<-lmer(sen~ AI+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.MAP<-lmer(sen~ MAP+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.pre_S<-lmer(sen~ pre_S+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.meanT_Q<-lmer(sen~ meanT_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.Pdry_Q<-lmer(sen~ Pdry_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.maxT_m<-lmer(sen~ maxT_m+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_10cm<-lmer(sen~ mean_10cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_40cm<-lmer(sen~ mean_40cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_1m<-lmer(sen~ mean_1m.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
AIC(lm.MAT);AIC(lm.AI);AIC(lm.MAP);AIC(lm.pre_S);AIC(lm.meanT_Q);AIC(lm.Pdry_Q);AIC(lm.maxT_m);AIC(lm.sm_10cm);AIC(lm.sm_40cm);AIC(lm.sm_1m)

AIC(lm.MAT);AIC(lm.maxT_m);AIC(lm.MAP);AIC(lm.AI);AIC(lm.sm_10cm);AIC(lm.sm_40cm)

summary(lm.AI)

```
```{r}
#3)figure
figp_h<-ggplot(study.site.last, aes(AI,sen))+
  
  geom_point(shape=21,color="blue",aes(size=factor(term)),stroke=0.8)+
  
  #geom_smooth(method = "lm",formula=y~log(x),se=T,
  #            fill="cornflowerblue",color='blue',size=1.2)+
  #labs(title = "Warming")+
  #annotate("text", x = 0.05, y = 150, label = "a",size=6)+
  #annotate("text", x = 20, y = -30, label = "R2=0.15, p = 0.02",size=4)+
  scale_x_continuous(name = "Aridity index",limits=c(0,0.6),breaks=seq(0,0.6,0.2)) +
  scale_y_continuous(name="H sensitivity under P",limits=c(-30,60),
                     breaks=seq(-30,60,30))+
  geom_hline(yintercept=0, linetype="dashed", color = "black",size=1.0)+
  theme_bw()+
  theme(plot.background=element_blank(),
        panel.spacing.x=unit(2, 'lines'),
        axis.ticks.length=unit(.2, "cm"),
        plot.title=element_text(lineheight=2,hjust=0.5),
        panel.background=element_blank(),
        #panel.grid.minor=element_blank(),
        #panel.grid.major=element_blank(),
        panel.border=element_rect(fill=NULL,colour='black',linetype=1,size=1),
        # axis.line=element_line(colour='black',linetype=1),
        axis.ticks=element_line(colour='black',linetype=1),
        axis.title.y = element_blank(),
        axis.text.y  = element_text(colour='black',vjust=0.5, size=10),
        axis.title.x = element_text(colour='black',size=12,vjust=0.2),
        axis.text.x  = element_text(colour='black',angle=0, vjust=0.2, size=10),
        legend.position = 'none',
        strip.background = element_blank(),
        strip.text =  element_text(colour='black',size=25,vjust=1),
        plot.margin = unit(c(0.2,0.2,0.2,0.2),'cm'))
figp_h
```
##plot
```{r fig.width=3,fig.height=9}
p<-cowplot::plot_grid(figp_agb,figp_cov,figp_den,figp_sp,figp_h,ncol=1,align = 'hv')
ggsave(p,filename = '/Users/daijunliu/Downloads/p_all.tiff',width = 3,height = 10,dpi = 200)
```

#1.5.3 Nitrogen addition
##AGB
```{r}
names(sen.climate)
study.site.last<-sen.climate%>%filter(metric=="AGB")%>%filter(Treat=="N")%>%
       distinct()
#2)test sig correlation LME
library(afex)#to show the p sen
lm.MAT<-lmer(sen~ MAT+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.AI<-lmer(sen~ AI+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.MAP<-lmer(sen~ MAP+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.pre_S<-lmer(sen~ pre_S+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.meanT_Q<-lmer(sen~ meanT_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.Pdry_Q<-lmer(sen~ Pdry_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.maxT_m<-lmer(sen~ maxT_m+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_10cm<-lmer(sen~ mean_10cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_40cm<-lmer(sen~ mean_40cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_1m<-lmer(sen~ mean_1m.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
AIC(lm.MAT);AIC(lm.AI);AIC(lm.MAP);AIC(lm.pre_S);AIC(lm.meanT_Q);AIC(lm.Pdry_Q);AIC(lm.maxT_m);AIC(lm.sm_10cm);AIC(lm.sm_40cm);AIC(lm.sm_1m)

AIC(lm.MAT);AIC(lm.maxT_m);AIC(lm.MAP);AIC(lm.AI);AIC(lm.sm_10cm);AIC(lm.sm_40cm)


summary(lm.AI)


lm.AI.log<-lmer(sen~ log(AI)+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
summary(lm.AI.log) 

```
```{r}
#3)figure
fign_agb<-ggplot(study.site.last, aes(AI,sen))+
  
  geom_point(shape=21,color="magenta2",aes(size=factor(term)),stroke=0.8)+
  
  geom_smooth(method = "lm",formula=y~log(x),se=T,
              fill="mediumorchid1",color='magenta2',size=1.2,linetype = "dashed")+
  #labs(title = "Warming")+
  #annotate("text", x = 0.05, y = 150, label = "a",size=6)+
  #annotate("text", x = 20, y = -30, label = "R2=0.15, p = 0.02",size=4)+
  scale_x_continuous(name = "Aridity index",
                     limits=c(0,2),breaks=seq(0,2,0.5)) +
  scale_y_continuous(name="AGB sensitivity under W",limits=c(-20,45),
                     breaks=seq(-20,40,20))+
  geom_hline(yintercept=0, linetype="dashed", color = "black",size=1.0)+
  theme_bw()+
  theme(plot.background=element_blank(),
        panel.spacing.x=unit(2, 'lines'),
        axis.ticks.length=unit(.2, "cm"),
        plot.title=element_text(lineheight=2,hjust=0.5),
        panel.background=element_blank(),
        #panel.grid.minor=element_blank(),
        #panel.grid.major=element_blank(),
        panel.border=element_rect(fill=NULL,colour='black',linetype=1,size=1),
        # axis.line=element_line(colour='black',linetype=1),
        axis.ticks=element_line(colour='black',linetype=1),
        axis.title.y = element_blank(),
        axis.text.y  = element_text(colour='black',vjust=0.5, size=10),
        axis.title.x = element_text(colour='black',size=12,vjust=0.2),
        axis.text.x  = element_text(colour='black',angle=0, vjust=0.2, size=10),
        legend.position = 'none',
        strip.background = element_blank(),
        strip.text =  element_text(colour='black',size=25,vjust=1),
        plot.margin = unit(c(0.2,0.2,0.2,0.2),'cm'))
fign_agb
```
##COV
```{r}
names(sen.climate)
study.site.last<-sen.climate%>%filter(metric=="COV")%>%filter(Treat=="N")%>%
       distinct()
#2)test sig correlation LME
library(afex)#to show the p sen
lm.MAT<-lmer(sen~ MAT+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.AI<-lmer(sen~ AI+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.MAP<-lmer(sen~ MAP+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.pre_S<-lmer(sen~ pre_S+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.meanT_Q<-lmer(sen~ meanT_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.Pdry_Q<-lmer(sen~ Pdry_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.maxT_m<-lmer(sen~ maxT_m+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_10cm<-lmer(sen~ mean_10cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_40cm<-lmer(sen~ mean_40cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_1m<-lmer(sen~ mean_1m.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
AIC(lm.MAT);AIC(lm.AI);AIC(lm.MAP);AIC(lm.pre_S);AIC(lm.meanT_Q);AIC(lm.Pdry_Q);AIC(lm.maxT_m);AIC(lm.sm_10cm);AIC(lm.sm_40cm);AIC(lm.sm_1m)

AIC(lm.MAT);AIC(lm.maxT_m);AIC(lm.MAP);AIC(lm.AI);AIC(lm.sm_10cm);AIC(lm.sm_40cm)

summary(lm.AI)

lm.AI.log<-lmer(sen~ log(AI)+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
summary(lm.AI.log) 
```
```{r}
#3)figure
fign_cov<-ggplot(study.site.last, aes(mean_40cm.sm,sen))+
  geom_point(shape=21,color="magenta2",aes(size=factor(term)),stroke=0.8)+
  
  geom_smooth(method = "lm",formula=y~x,se=T,
              fill="mediumorchid1",color='magenta2',size=1.2)+
  #labs(title = "Warming")+
  #annotate("text", x = 0.05, y = 150, label = "a",size=6)+
  #annotate("text", x = 20, y = -30, label = "R2=0.15, p = 0.02",size=4)+
  scale_x_continuous(name = "Soil moisture (40cm)",limits=c(30,100),breaks=seq(30,100,20)) +
  scale_y_continuous(name="AGB sensitivity under W",limits=c(-50,15),
                     breaks=seq(-50,15,20))+
  geom_hline(yintercept=0, linetype="dashed", color = "black",size=1.0)+
  theme_bw()+
  theme(plot.background=element_blank(),
        panel.spacing.x=unit(2, 'lines'),
        axis.ticks.length=unit(.2, "cm"),
        plot.title=element_text(lineheight=2,hjust=0.5),
        panel.background=element_blank(),
        #panel.grid.minor=element_blank(),
        #panel.grid.major=element_blank(),
        panel.border=element_rect(fill=NULL,colour='black',linetype=1,size=1),
        # axis.line=element_line(colour='black',linetype=1),
        axis.ticks=element_line(colour='black',linetype=1),
        axis.title.y = element_blank(),
        axis.text.y  = element_text(colour='black',vjust=0.5, size=10),
        axis.title.x = element_text(colour='black',size=12,vjust=0.2),
        axis.text.x  = element_text(colour='black',angle=0, vjust=0.2, size=10),
        legend.position = 'none',
        strip.background = element_blank(),
        strip.text =  element_text(colour='black',size=25,vjust=1),
        plot.margin = unit(c(0.2,0.2,0.2,0.2),'cm'))
fign_cov
```

##DEN
```{r}
names(sen.climate)
study.site.last<-sen.climate%>%filter(metric=="DEN")%>%filter(Treat=="N")%>%
       distinct()
#2)test sig correlation LME
library(afex)#to show the p sen
lm.MAT<-lmer(sen~ MAT+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.AI<-lmer(sen~ AI+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.MAP<-lmer(sen~ MAP+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.pre_S<-lmer(sen~ pre_S+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.meanT_Q<-lmer(sen~ meanT_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.Pdry_Q<-lmer(sen~ Pdry_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.maxT_m<-lmer(sen~ maxT_m+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_10cm<-lmer(sen~ mean_10cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_40cm<-lmer(sen~ mean_40cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_1m<-lmer(sen~ mean_1m.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
AIC(lm.MAT);AIC(lm.AI);AIC(lm.MAP);AIC(lm.pre_S);AIC(lm.meanT_Q);AIC(lm.Pdry_Q);AIC(lm.maxT_m);AIC(lm.sm_10cm);AIC(lm.sm_40cm);AIC(lm.sm_1m)

AIC(lm.MAT);AIC(lm.maxT_m);AIC(lm.MAP);AIC(lm.AI);AIC(lm.sm_10cm);AIC(lm.sm_40cm)


summary(lm.AI)

lm.AI.log<-lmer(sen~ log(AI)+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
summary(lm.AI.log) 
```
```{r}
#3)figure
fign_den<-ggplot(study.site.last, aes(AI,sen))+
  
  geom_point(shape=21,color="magenta2",aes(size=factor(term)),stroke=0.8)+
  
  #geom_smooth(method = "lm",formula=y~x,se=T,
  #            fill="mediumorchid1",color='magenta2',size=1.2)+
  #labs(title = "Warming")+
  #annotate("text", x = 0.05, y = 150, label = "a",size=6)+
  #annotate("text", x = 20, y = -30, label = "R2=0.15, p = 0.02",size=4)+
  scale_x_continuous(name = "Aridity index",limits=c(0,3),breaks=seq(0,3,1)) +
  scale_y_continuous(name="DEN sensitivity under W",limits=c(-10,10),
                     breaks=seq(-10,10,5))+
  geom_hline(yintercept=0, linetype="dashed", color = "black",size=1.0)+
  theme_bw()+
  theme(plot.background=element_blank(),
        panel.spacing.x=unit(2, 'lines'),
        axis.ticks.length=unit(.2, "cm"),
        plot.title=element_text(lineheight=2,hjust=0.5),
        panel.background=element_blank(),
        #panel.grid.minor=element_blank(),
        #panel.grid.major=element_blank(),
        panel.border=element_rect(fill=NULL,colour='black',linetype=1,size=1),
        # axis.line=element_line(colour='black',linetype=1),
        axis.ticks=element_line(colour='black',linetype=1),
        axis.title.y = element_blank(),
        axis.text.y  = element_text(colour='black',vjust=0.5, size=10),
        axis.title.x = element_text(colour='black',size=12,vjust=0.2),
        axis.text.x  = element_text(colour='black',angle=0, vjust=0.2, size=10),
        legend.position = 'none',
        strip.background = element_blank(),
        strip.text =  element_text(colour='black',size=25,vjust=1),
        plot.margin = unit(c(0.2,0.2,0.2,0.2),'cm'))
fign_den
```
##SP
```{r}
names(sen.climate)
study.site.last<-sen.climate%>%filter(metric=="SP")%>%filter(Treat=="N")%>%
       distinct()
#2)test sig correlation LME
library(afex)#to show the p sen
lm.MAT<-lmer(sen~ MAT+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.AI<-lmer(sen~ AI+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.MAP<-lmer(sen~ MAP+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.pre_S<-lmer(sen~ pre_S+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.meanT_Q<-lmer(sen~ meanT_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.Pdry_Q<-lmer(sen~ Pdry_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.maxT_m<-lmer(sen~ maxT_m+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_10cm<-lmer(sen~ mean_10cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_40cm<-lmer(sen~ mean_40cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_1m<-lmer(sen~ mean_1m.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
AIC(lm.MAT);AIC(lm.AI);AIC(lm.MAP);AIC(lm.pre_S);AIC(lm.meanT_Q);AIC(lm.Pdry_Q);AIC(lm.maxT_m);AIC(lm.sm_10cm);AIC(lm.sm_40cm);AIC(lm.sm_1m)

AIC(lm.MAT);AIC(lm.maxT_m);AIC(lm.MAP);AIC(lm.AI);AIC(lm.sm_10cm);AIC(lm.sm_40cm)


summary(lm.AI)

lm.AI.log<-lmer(sen~ log(AI)+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
summary(lm.AI.log) 
```
```{r}
#3)figure
fign_sp<-ggplot(study.site.last, aes(AI,sen))+
  
  geom_point(shape=21,color="magenta2",aes(size=factor(term)),stroke=0.8)+
  
  #geom_smooth(method = "lm",formula=y~x,se=T,
  #            fill="mediumorchid1",color='magenta2',size=1.2)+
  #labs(title = "Warming")+
  #annotate("text", x = 0.05, y = 150, label = "a",size=6)+
  #annotate("text", x = 20, y = -30, label = "R2=0.15, p = 0.02",size=4)+
  scale_x_continuous(name = "Aridity index",limits=c(0,2),breaks=seq(0,2,0.5)) +
  scale_y_continuous(name="SP sensitivity under W",limits=c(-40,25),
                     breaks=seq(-40,25,20))+
  geom_hline(yintercept=0, linetype="dashed", color = "black",size=1.0)+
  theme_bw()+
  theme(plot.background=element_blank(),
        panel.spacing.x=unit(2, 'lines'),
        axis.ticks.length=unit(.2, "cm"),
        plot.title=element_text(lineheight=2,hjust=0.5),
        panel.background=element_blank(),
        #panel.grid.minor=element_blank(),
        #panel.grid.major=element_blank(),
        panel.border=element_rect(fill=NULL,colour='black',linetype=1,size=1),
        # axis.line=element_line(colour='black',linetype=1),
        axis.ticks=element_line(colour='black',linetype=1),
        axis.title.y = element_blank(),
        axis.text.y  = element_text(colour='black',vjust=0.5, size=10),
        axis.title.x = element_text(colour='black',size=12,vjust=0.2),
        axis.text.x  = element_text(colour='black',angle=0, vjust=0.2, size=10),
        legend.position = 'none',
        strip.background = element_blank(),
        strip.text =  element_text(colour='black',size=25,vjust=1),
        plot.margin = unit(c(0.2,0.2,0.2,0.2),'cm'))
fign_sp
```

##H
```{r}
names(sen.climate)
study.site.last<-sen.climate%>%filter(metric=="H")%>%filter(Treat=="N")%>%
       distinct()
#2)test sig correlation LME
library(afex)#to show the p sen
lm.MAT<-lmer(sen~ MAT+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.AI<-lmer(sen~ AI+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.MAP<-lmer(sen~ MAP+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.pre_S<-lmer(sen~ pre_S+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.meanT_Q<-lmer(sen~ meanT_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.Pdry_Q<-lmer(sen~ Pdry_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.maxT_m<-lmer(sen~ maxT_m+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_10cm<-lmer(sen~ mean_10cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_40cm<-lmer(sen~ mean_40cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_1m<-lmer(sen~ mean_1m.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
AIC(lm.MAT);AIC(lm.AI);AIC(lm.MAP);AIC(lm.pre_S);AIC(lm.meanT_Q);AIC(lm.Pdry_Q);AIC(lm.maxT_m);AIC(lm.sm_10cm);AIC(lm.sm_40cm);AIC(lm.sm_1m)

AIC(lm.MAT);AIC(lm.maxT_m);AIC(lm.MAP);AIC(lm.AI);AIC(lm.sm_10cm);AIC(lm.sm_40cm)

summary(lm.AI)
```
```{r}
#3)figure
fign_h<-ggplot(study.site.last, aes(AI,sen))+
  
  geom_point(shape=21,color="magenta2",aes(size=factor(term)),stroke=0.8)+
  
  #geom_smooth(method = "lm",formula=y~x,se=T,
  #            fill="mediumorchid1",color='magenta2',size=1.2)+
  #labs(title = "Warming")+
  #annotate("text", x = 0.05, y = 150, label = "a",size=6)+
  #annotate("text", x = 20, y = -30, label = "R2=0.15, p = 0.02",size=4)+
  scale_x_continuous(name = "Aridity index",limits=c(0,2.6),breaks=seq(0,2.5,0.8)) +
  scale_y_continuous(name="H sensitivity under P",limits=c(-5,10),
                     breaks=seq(-5,10,5))+
  geom_hline(yintercept=0, linetype="dashed", color = "black",size=1.0)+
  theme_bw()+
  theme(plot.background=element_blank(),
        panel.spacing.x=unit(2, 'lines'),
        axis.ticks.length=unit(.2, "cm"),
        plot.title=element_text(lineheight=2,hjust=0.5),
        panel.background=element_blank(),
        #panel.grid.minor=element_blank(),
        #panel.grid.major=element_blank(),
        panel.border=element_rect(fill=NULL,colour='black',linetype=1,size=1),
        # axis.line=element_line(colour='black',linetype=1),
        axis.ticks=element_line(colour='black',linetype=1),
        axis.title.y = element_blank(),
        axis.text.y  = element_text(colour='black',vjust=0.5, size=10),
        axis.title.x = element_text(colour='black',size=12,vjust=0.2),
        axis.text.x  = element_text(colour='black',angle=0, vjust=0.2, size=10),
        legend.position = 'none',
        strip.background = element_blank(),
        strip.text =  element_text(colour='black',size=25,vjust=1),
        plot.margin = unit(c(0.2,0.2,0.2,0.2),'cm'))
fign_h
```

##plot
```{r fig.width=3,fig.height=9}
n<-cowplot::plot_grid(fign_agb,fign_cov,fign_den,fign_sp,fign_h,ncol=1,align = 'hv')
ggsave(n,filename = '.../n_all.tiff',width = 3,height = 10,dpi = 200)
```


#1.5.2.4 Drought
##AGB
```{r}
names(sen.climate)
study.site.last<-sen.climate%>%filter(metric=="AGB")%>%filter(Treat=="D")%>%
       distinct()
#2)test sig correlation LME
library(afex)#to show the p sen
lm.MAT<-lmer(sen~ MAT+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.AI<-lmer(sen~ AI+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.MAP<-lmer(sen~ MAP+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.pre_S<-lmer(sen~ pre_S+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.meanT_Q<-lmer(sen~ meanT_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.Pdry_Q<-lmer(sen~ Pdry_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.maxT_m<-lmer(sen~ maxT_m+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_10cm<-lmer(sen~ mean_10cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_40cm<-lmer(sen~ mean_40cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_1m<-lmer(sen~ mean_1m.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
AIC(lm.MAT);AIC(lm.AI);AIC(lm.MAP);AIC(lm.pre_S);AIC(lm.meanT_Q);AIC(lm.Pdry_Q);AIC(lm.maxT_m);AIC(lm.sm_10cm);AIC(lm.sm_40cm);AIC(lm.sm_1m)

AIC(lm.MAT);AIC(lm.maxT_m);AIC(lm.MAP);AIC(lm.AI);AIC(lm.sm_10cm);AIC(lm.sm_40cm)


summary(lm.AI)

lm.AI.log<-lmer(sen~ log(AI)+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
summary(lm.AI.log) 

```
```{r}
#3)figure
figd_agb<-ggplot(study.site.last, aes(AI,sen))+
  
  geom_point(shape=21,color="orange",aes(size=factor(term)),stroke=0.8)+
  
  geom_smooth(method = "lm",formula=y~log(x),se=T,
              fill="khaki1",color='orange',size=1.2)+
  #labs(title = "Warming")+
  #annotate("text", x = 0.05, y = 150, label = "a",size=6)+
  #annotate("text", x = 20, y = -30, label = "R2=0.15, p = 0.02",size=4)+
  scale_x_continuous(name = "Aridity index",limits=c(0,2.3),breaks=seq(0,2,0.5)) +
  scale_y_continuous(name="AGB sensitivity under W",limits=c(-120,45),
                     breaks=seq(-120,45,40))+
  geom_hline(yintercept=0, linetype="dashed", color = "black",size=1.0)+
  theme_bw()+
  theme(plot.background=element_blank(),
        panel.spacing.x=unit(2, 'lines'),
        axis.ticks.length=unit(.2, "cm"),
        plot.title=element_text(lineheight=2,hjust=0.5),
        panel.background=element_blank(),
        #panel.grid.minor=element_blank(),
        #panel.grid.major=element_blank(),
        panel.border=element_rect(fill=NULL,colour='black',linetype=1,size=1),
        # axis.line=element_line(colour='black',linetype=1),
        axis.ticks=element_line(colour='black',linetype=1),
        axis.title.y = element_blank(),
        axis.text.y  = element_text(colour='black',vjust=0.5, size=10),
        axis.title.x = element_text(colour='black',size=12,vjust=0.2),
        axis.text.x  = element_text(colour='black',angle=0, vjust=0.2, size=10),
        legend.position = 'none',
        strip.background = element_blank(),
        strip.text =  element_text(colour='black',size=25,vjust=1),
        plot.margin = unit(c(0.2,0.2,0.2,0.2),'cm'))
figd_agb
```
##COV
```{r}
names(sen.climate)
study.site.last<-sen.climate%>%filter(metric=="COV")%>%filter(Treat=="D")%>%
       distinct()
#2)test sig correlation LME
library(afex)#to show the p sen
lm.MAT<-lmer(sen~ MAT+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.AI<-lmer(sen~ AI+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.MAP<-lmer(sen~ MAP+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.pre_S<-lmer(sen~ pre_S+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.meanT_Q<-lmer(sen~ meanT_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.Pdry_Q<-lmer(sen~ Pdry_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.maxT_m<-lmer(sen~ maxT_m+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_10cm<-lmer(sen~ mean_10cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_40cm<-lmer(sen~ mean_40cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_1m<-lmer(sen~ mean_1m.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
AIC(lm.MAT);AIC(lm.AI);AIC(lm.MAP);AIC(lm.pre_S);AIC(lm.meanT_Q);AIC(lm.Pdry_Q);AIC(lm.maxT_m);AIC(lm.sm_10cm);AIC(lm.sm_40cm);AIC(lm.sm_1m)
AIC(lm.MAT);AIC(lm.maxT_m);AIC(lm.MAP);AIC(lm.AI);AIC(lm.sm_10cm);AIC(lm.sm_40cm)


summary(lm.AI)

lm.AI.log<-lmer(sen~ log(AI)+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
summary(lm.AI.log) 
```
```{r}
#3)figure
figd_cov<-ggplot(study.site.last, aes(AI,sen))+
  
  geom_point(shape=21,color="orange",aes(size=factor(term)),stroke=0.8)+
  
  geom_smooth(method = "lm",formula=y~log(x),se=T,
              fill="khaki1",color='orange',size=1.2)+
  #labs(title = "Warming")+
  #annotate("text", x = 0.05, y = 150, label = "a",size=6)+
  #annotate("text", x = 20, y = -30, label = "R2=0.15, p = 0.02",size=4)+
  scale_x_continuous(name = "Aridity index",limits=c(0,2.2),breaks=seq(0,2,0.5)) +
  scale_y_continuous(name="AGB sensitivity under W",limits=c(-30,30),
                     breaks=seq(-30,30,15))+
  geom_hline(yintercept=0, linetype="dashed", color = "black",size=1.0)+
  theme_bw()+
  theme(plot.background=element_blank(),
        panel.spacing.x=unit(2, 'lines'),
        axis.ticks.length=unit(.2, "cm"),
        plot.title=element_text(lineheight=2,hjust=0.5),
        panel.background=element_blank(),
        #panel.grid.minor=element_blank(),
        #panel.grid.major=element_blank(),
        panel.border=element_rect(fill=NULL,colour='black',linetype=1,size=1),
        # axis.line=element_line(colour='black',linetype=1),
        axis.ticks=element_line(colour='black',linetype=1),
        axis.title.y = element_blank(),
        axis.text.y  = element_text(colour='black',vjust=0.5, size=10),
        axis.title.x = element_text(colour='black',size=12,vjust=0.2),
        axis.text.x  = element_text(colour='black',angle=0, vjust=0.2, size=10),
        legend.position = 'none',
        strip.background = element_blank(),
        strip.text =  element_text(colour='black',size=25,vjust=1),
        plot.margin = unit(c(0.2,0.2,0.2,0.2),'cm'))
figd_cov
```

##DEN
```{r}
names(sen.climate)
study.site.last<-sen.climate%>%filter(metric=="DEN")%>%filter(Treat=="D")%>%
       distinct()
#2)test sig correlation LME
library(afex)#to show the p sen
lm.MAT<-lmer(sen~ MAT+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.AI<-lmer(sen~ AI+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.MAP<-lmer(sen~ MAP+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.pre_S<-lmer(sen~ pre_S+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.meanT_Q<-lmer(sen~ meanT_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.Pdry_Q<-lmer(sen~ Pdry_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.maxT_m<-lmer(sen~ maxT_m+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_10cm<-lmer(sen~ mean_10cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_40cm<-lmer(sen~ mean_40cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_1m<-lmer(sen~ mean_1m.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
AIC(lm.MAT);AIC(lm.AI);AIC(lm.MAP);AIC(lm.pre_S);AIC(lm.meanT_Q);AIC(lm.Pdry_Q);AIC(lm.maxT_m);AIC(lm.sm_10cm);AIC(lm.sm_40cm);AIC(lm.sm_1m)

AIC(lm.MAT);AIC(lm.maxT_m);AIC(lm.MAP);AIC(lm.AI);AIC(lm.sm_10cm);AIC(lm.sm_40cm)

summary(lm.AI)
```
```{r}
#3)figure
figd_den<-ggplot(study.site.last, aes(AI,sen))+
  
  geom_point(shape=21,color="orange",aes(size=factor(term)),stroke=0.8)+
  
  #geom_smooth(method = "lm",formula=y~log(x),se=T,
  #            fill="khaki1",color='orange',size=1.2)+
  #labs(title = "Warming")+
  #annotate("text", x = 0.05, y = 150, label = "a",size=6)+
  #annotate("text", x = 20, y = -30, label = "R2=0.15, p = 0.02",size=4)+
  scale_x_continuous(name = "Aridity index",limits=c(0,0.8),breaks=seq(0,0.8,0.2)) +
  scale_y_continuous(name="DEN sensitivity under D",limits=c(-150,55),
                     breaks=seq(-150,50,50))+
  geom_hline(yintercept=0, linetype="dashed", color = "black",size=1.0)+
  theme_bw()+
  theme(plot.background=element_blank(),
        panel.spacing.x=unit(2, 'lines'),
        axis.ticks.length=unit(.2, "cm"),
        plot.title=element_text(lineheight=2,hjust=0.5),
        panel.background=element_blank(),
        #panel.grid.minor=element_blank(),
        #panel.grid.major=element_blank(),
        panel.border=element_rect(fill=NULL,colour='black',linetype=1,size=1),
        # axis.line=element_line(colour='black',linetype=1),
        axis.ticks=element_line(colour='black',linetype=1),
        axis.title.y = element_blank(),
        axis.text.y  = element_text(colour='black',vjust=0.5, size=10),
        axis.title.x = element_text(colour='black',size=12,vjust=0.2),
        axis.text.x  = element_text(colour='black',angle=0, vjust=0.2, size=10),
        legend.position = 'none',
        strip.background = element_blank(),
        strip.text =  element_text(colour='black',size=25,vjust=1),
        plot.margin = unit(c(0.2,0.2,0.2,0.2),'cm'))
figd_den
```
##SP
```{r}
names(sen.climate)
study.site.last<-sen.climate%>%filter(metric=="SP")%>%filter(Treat=="D")%>%
       distinct()
#2)test sig correlation LME
library(afex)#to show the p sen
lm.MAT<-lmer(sen~ MAT+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.AI<-lmer(sen~ AI+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.MAP<-lmer(sen~ MAP+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.pre_S<-lmer(sen~ pre_S+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.meanT_Q<-lmer(sen~ meanT_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.Pdry_Q<-lmer(sen~ Pdry_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.maxT_m<-lmer(sen~ maxT_m+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_10cm<-lmer(sen~ mean_10cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_40cm<-lmer(sen~ mean_40cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_1m<-lmer(sen~ mean_1m.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
AIC(lm.MAT);AIC(lm.AI);AIC(lm.MAP);AIC(lm.pre_S);AIC(lm.meanT_Q);AIC(lm.Pdry_Q);AIC(lm.maxT_m);AIC(lm.sm_10cm);AIC(lm.sm_40cm);AIC(lm.sm_1m)

AIC(lm.MAT);AIC(lm.maxT_m);AIC(lm.MAP);AIC(lm.AI);AIC(lm.sm_10cm);AIC(lm.sm_40cm)

summary(lm.AI)
```
```{r}
#3)figure
figd_sp<-ggplot(study.site.last, aes(AI,sen))+
  
  geom_point(shape=21,color="orange",aes(size=factor(term)),stroke=0.8)+
  
  #geom_smooth(method = "lm",formula=y~log(x),se=T,
  #            fill="cornflowerblue",color='blue',size=1.2)+
  #labs(title = "Warming")+
  #annotate("text", x = 0.05, y = 150, label = "a",size=6)+
  #annotate("text", x = 20, y = -30, label = "R2=0.15, p = 0.02",size=4)+
  scale_x_continuous(name = "Aridity index",limits=c(0,0.9),breaks=seq(0,0.9,0.3)) +
  scale_y_continuous(name="SP sensitivity under D",limits=c(-50,150),
                     breaks=seq(-50,150,50))+
  geom_hline(yintercept=0, linetype="dashed", color = "black",size=1.0)+
  theme_bw()+
  theme(plot.background=element_blank(),
        panel.spacing.x=unit(2, 'lines'),
        axis.ticks.length=unit(.2, "cm"),
        plot.title=element_text(lineheight=2,hjust=0.5),
        panel.background=element_blank(),
        #panel.grid.minor=element_blank(),
        #panel.grid.major=element_blank(),
        panel.border=element_rect(fill=NULL,colour='black',linetype=1,size=1),
        # axis.line=element_line(colour='black',linetype=1),
        axis.ticks=element_line(colour='black',linetype=1),
        axis.title.y = element_blank(),
        axis.text.y  = element_text(colour='black',vjust=0.5, size=10),
        axis.title.x = element_text(colour='black',size=12,vjust=0.2),
        axis.text.x  = element_text(colour='black',angle=0, vjust=0.2, size=10),
        legend.position = 'none',
        strip.background = element_blank(),
        strip.text =  element_text(colour='black',size=25,vjust=1),
        plot.margin = unit(c(0.2,0.2,0.2,0.2),'cm'))
figd_sp
```

##H
```{r}
names(sen.climate)
study.site.last<-sen.climate%>%filter(metric=="H")%>%filter(Treat=="D")%>%
       distinct()
#2)test sig correlation LME
library(afex)#to show the p sen
lm.MAT<-lmer(sen~ MAT+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.AI<-lmer(sen~ AI+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.MAP<-lmer(sen~ MAP+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.pre_S<-lmer(sen~ pre_S+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.meanT_Q<-lmer(sen~ meanT_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.Pdry_Q<-lmer(sen~ Pdry_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.maxT_m<-lmer(sen~ maxT_m+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_10cm<-lmer(sen~ mean_10cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_40cm<-lmer(sen~ mean_40cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_1m<-lmer(sen~ mean_1m.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
AIC(lm.MAT);AIC(lm.AI);AIC(lm.MAP);AIC(lm.pre_S);AIC(lm.meanT_Q);AIC(lm.Pdry_Q);AIC(lm.maxT_m);AIC(lm.sm_10cm);AIC(lm.sm_40cm);AIC(lm.sm_1m)
AIC(lm.MAT);AIC(lm.maxT_m);AIC(lm.MAP);AIC(lm.AI);AIC(lm.sm_10cm);AIC(lm.sm_40cm)
summary(lm.AI)
```
```{r}
#3)figure
figd_h<-ggplot(study.site.last, aes(AI,sen))+
  
  geom_point(shape=21,color="orange",aes(size=factor(term)),stroke=0.8)+
  
  #geom_smooth(method = "lm",formula=y~log(x),se=T,
  #            fill="cornflowerblue",color='blue',size=1.2)+
  #labs(title = "Warming")+
  #annotate("text", x = 0.05, y = 150, label = "a",size=6)+
  #annotate("text", x = 20, y = -30, label = "R2=0.15, p = 0.02",size=4)+
  scale_x_continuous(name = "Aridity index",limits=c(0,2.4),breaks=seq(0,2.4,0.8)) +
  scale_y_continuous(name="H sensitivity under P",limits=c(-40,40),
                     breaks=seq(-40,40,20))+
  geom_hline(yintercept=0, linetype="dashed", color = "black",size=1.0)+
  theme_bw()+
  theme(plot.background=element_blank(),
        panel.spacing.x=unit(2, 'lines'),
        axis.ticks.length=unit(.2, "cm"),
        plot.title=element_text(lineheight=2,hjust=0.5),
        panel.background=element_blank(),
        #panel.grid.minor=element_blank(),
        #panel.grid.major=element_blank(),
        panel.border=element_rect(fill=NULL,colour='black',linetype=1,size=1),
        # axis.line=element_line(colour='black',linetype=1),
        axis.ticks=element_line(colour='black',linetype=1),
        axis.title.y = element_blank(),
        axis.text.y  = element_text(colour='black',vjust=0.5, size=10),
        axis.title.x = element_text(colour='black',size=12,vjust=0.2),
        axis.text.x  = element_text(colour='black',angle=0, vjust=0.2, size=10),
        legend.position = 'none',
        strip.background = element_blank(),
        strip.text =  element_text(colour='black',size=25,vjust=1),
        plot.margin = unit(c(0.2,0.2,0.2,0.2),'cm'))
figd_h
```

##plot
```{r fig.width=3,fig.height=9}
d<-cowplot::plot_grid(figd_agb,figd_cov,figd_den,figd_sp,figd_h,ncol=1,align = 'hv')
ggsave(d,filename = '.../d_all.tiff',width = 3,height = 10,dpi = 200)
```

#1.6 encroachment

## Ratio warming
```{r}
names(sen.climate)
study.site.last<-sen.climate%>%filter(metric=="Ratio_S")%>%filter(Treat=="W")%>%
       distinct()
#2)test sig correlation LME
library(afex)#to show the p sen
lm.MAT<-lmer(sen~ MAT+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.AI<-lmer(sen~ AI+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.MAP<-lmer(sen~ MAP+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.pre_S<-lmer(sen~ pre_S+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.meanT_Q<-lmer(sen~ meanT_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.Pdry_Q<-lmer(sen~ Pdry_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.maxT_m<-lmer(sen~ maxT_m+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_10cm<-lmer(sen~ mean_10cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_40cm<-lmer(sen~ mean_40cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_1m<-lmer(sen~ mean_1m.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
AIC(lm.MAT);AIC(lm.AI);AIC(lm.MAP);AIC(lm.pre_S);AIC(lm.meanT_Q);AIC(lm.Pdry_Q);AIC(lm.maxT_m);AIC(lm.sm_10cm);AIC(lm.sm_40cm);AIC(lm.sm_1m)

summary(lm.sm_40cm)

lm.sm_40cm.log<-lmer(sen~ log(mean_40cm.sm)+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
summary(lm.sm_40cm.log) 
```
```{r}
#3)figure
figW_Ratio_W<-ggplot(study.site.last, aes(mean_40cm.sm,sen))+
  
  geom_point(shape=21,color="red",aes(size=factor(term)),stroke=0.8)+
  
  geom_smooth(method = "lm",formula=y~log(x),se=T,
              fill="indianred1",color='red',size=1.2)+
  #labs(title = "Warming")+
  #annotate("text", x = 0.05, y = 150, label = "a",size=6)+
  #annotate("text", x = 20, y = -30, label = "R2=0.15, p = 0.02",size=4)+
  scale_x_continuous(name = "Soil moisture (40cm)",limits=c(27,66),breaks=seq(30,60,10)) +
  scale_y_continuous(name="H sensitivity under P",limits=c(-15,35),
                     breaks=seq(-15,30,15))+
  geom_hline(yintercept=0, linetype="dashed", color = "black",size=1.0)+
  theme_bw()+
  theme(plot.background=element_blank(),
        panel.spacing.x=unit(2, 'lines'),
        axis.ticks.length=unit(.2, "cm"),
        plot.title=element_text(lineheight=2,hjust=0.5),
        panel.background=element_blank(),
        #panel.grid.minor=element_blank(),
        #panel.grid.major=element_blank(),
        panel.border=element_rect(fill=NULL,colour='black',linetype=1,size=1),
        # axis.line=element_line(colour='black',linetype=1),
        axis.ticks=element_line(colour='black',linetype=1),
        axis.title.y = element_blank(),
        axis.text.y  = element_text(colour='black',vjust=0.5, size=10),
        axis.title.x = element_text(colour='black',size=12,vjust=0.2),
        axis.text.x  = element_text(colour='black',angle=0, vjust=0.2, size=10),
        legend.position = 'none',
        strip.background = element_blank(),
        strip.text =  element_text(colour='black',size=25,vjust=1),
        plot.margin = unit(c(0.2,0.2,0.2,0.2),'cm'))
figW_Ratio_W
```

## ratio_S under P
```{r}
names(sen.climate)
study.site.last<-sen.climate%>%filter(metric=="Ratio_S")%>%filter(Treat=="P")%>%
       distinct()
#2)test sig correlation LME
library(afex)#to show the p sen
lm.MAT<-lmer(sen~ MAT+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.AI<-lmer(sen~ AI+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.MAP<-lmer(sen~ MAP+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.pre_S<-lmer(sen~ pre_S+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.meanT_Q<-lmer(sen~ meanT_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.Pdry_Q<-lmer(sen~ Pdry_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.maxT_m<-lmer(sen~ maxT_m+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_10cm<-lmer(sen~ mean_10cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_40cm<-lmer(sen~ mean_40cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_1m<-lmer(sen~ mean_1m.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
AIC(lm.MAT);AIC(lm.AI);AIC(lm.MAP);AIC(lm.pre_S);AIC(lm.meanT_Q);AIC(lm.Pdry_Q);AIC(lm.maxT_m);AIC(lm.sm_10cm);AIC(lm.sm_40cm);AIC(lm.sm_1m)
summary(lm.AI)
```
```{r}
#3)figure
fig_Ratio_p<-ggplot(study.site.last, aes(AI,sen))+
  
  geom_point(shape=21,color="blue",aes(size=factor(term)),stroke=0.8)+
  
  #geom_smooth(method = "lm",formula=y~log(x),se=T,
  #            fill="indianred1",color='red',size=1.2,linetype = "dashed")+
  #labs(title = "Warming")+
  #annotate("text", x = 0.05, y = 150, label = "a",size=6)+
  #annotate("text", x = 20, y = -30, label = "R2=0.15, p = 0.02",size=4)+
  scale_x_continuous(name = "Aridity index",limits=c(0,2.0),breaks=seq(0,2.0,0.5)) +
  scale_y_continuous(name="H sensitivity under P",limits=c(-50,100),
                     breaks=seq(-50,100,50))+
  geom_hline(yintercept=0, linetype="dashed", color = "black",size=1.0)+
  theme_bw()+
  theme(plot.background=element_blank(),
        panel.spacing.x=unit(2, 'lines'),
        axis.ticks.length=unit(.2, "cm"),
        plot.title=element_text(lineheight=2,hjust=0.5),
        panel.background=element_blank(),
        #panel.grid.minor=element_blank(),
        #panel.grid.major=element_blank(),
        panel.border=element_rect(fill=NULL,colour='black',linetype=1,size=1),
        # axis.line=element_line(colour='black',linetype=1),
        axis.ticks=element_line(colour='black',linetype=1),
        axis.title.y = element_blank(),
        axis.text.y  = element_text(colour='black',vjust=0.5, size=10),
        axis.title.x = element_text(colour='black',size=12,vjust=0.2),
        axis.text.x  = element_text(colour='black',angle=0, vjust=0.2, size=10),
        legend.position = 'none',
        strip.background = element_blank(),
        strip.text =  element_text(colour='black',size=25,vjust=1),
        plot.margin = unit(c(0.2,0.2,0.2,0.2),'cm'))
fig_Ratio_p
```

## ratio N
```{r}
names(sen.climate)
study.site.last<-sen.climate%>%filter(metric=="Ratio_S")%>%filter(Treat=="N")%>%
       distinct()
#2)test sig correlation LME
library(afex)#to show the p sen
lm.MAT<-lmer(sen~ MAT+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.AI<-lmer(sen~ AI+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.MAP<-lmer(sen~ MAP+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.pre_S<-lmer(sen~ pre_S+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.meanT_Q<-lmer(sen~ meanT_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.Pdry_Q<-lmer(sen~ Pdry_Q+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.maxT_m<-lmer(sen~ maxT_m+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_10cm<-lmer(sen~ mean_10cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_40cm<-lmer(sen~ mean_40cm.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
lm.sm_1m<-lmer(sen~ mean_1m.sm+(1|code),data=study.site.last,
     control=lmerControl(check.nobs.vs.nlev = "ignore",
     check.nobs.vs.rankZ = "ignore",check.nobs.vs.nRE="ignore"))
AIC(lm.MAT);AIC(lm.AI);AIC(lm.MAP);AIC(lm.pre_S);AIC(lm.meanT_Q);AIC(lm.Pdry_Q);AIC(lm.maxT_m);AIC(lm.sm_10cm);AIC(lm.sm_40cm);AIC(lm.sm_1m)
summary(lm.AI)
```
```{r}
#3)figure
fign_Ratio_S<-ggplot(study.site.last, aes(AI,sen))+
  
  geom_point(shape=21,color="magenta2",aes(size=factor(term)),stroke=0.8)+
  
 # geom_smooth(method = "lm",formula=y~x,se=T,
 #             fill="mediumorchid1",color='magenta2',size=1.2)+
  #labs(title = "Warming")+
  #annotate("text", x = 0.05, y = 150, label = "a",size=6)+
  #annotate("text", x = 20, y = -30, label = "R2=0.15, p = 0.02",size=4)+
  scale_x_continuous(name = "Aridity index",limits=c(0,2.0),breaks=seq(0,2.0,0.5)) +
  scale_y_continuous(name="H sensitivity under P",limits=c(-11,5),
                     breaks=seq(-10,5,5))+
  geom_hline(yintercept=0, linetype="dashed", color = "black",size=1.0)+
  theme_bw()+
  theme(plot.background=element_blank(),
        panel.spacing.x=unit(2, 'lines'),
        axis.ticks.length=unit(.2, "cm"),
        plot.title=element_text(lineheight=2,hjust=0.5),
        panel.background=element_blank(),
        #panel.grid.minor=element_blank(),
        #panel.grid.major=element_blank(),
        panel.border=element_rect(fill=NULL,colour='black',linetype=1,size=1),
        # axis.line=element_line(colour='black',linetype=1),
        axis.ticks=element_line(colour='black',linetype=1),
        axis.title.y = element_blank(),
        axis.text.y  = element_text(colour='black',vjust=0.5, size=10),
        axis.title.x = element_text(colour='black',size=12,vjust=0.2),
        axis.text.x  = element_text(colour='black',angle=0, vjust=0.2, size=10),
        legend.position = 'none',
        strip.background = element_blank(),
        strip.text =  element_text(colour='black',size=25,vjust=1),
        plot.margin = unit(c(0.2,0.2,0.2,0.2),'cm'))
fign_Ratio_S
```

##plot
```{r fig.width=3,fig.height=9}
RATIO<-cowplot::plot_grid(figW_Ratio_W,fig_Ratio_p,fign_Ratio_S,ncol=3,align = 'hv')
ggsave(RATIO,filename = '.../RATIO_all.tiff',width = 10,height = 3.2,dpi = 200)
```

